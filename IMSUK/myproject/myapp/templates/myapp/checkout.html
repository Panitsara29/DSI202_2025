{% extends 'myapp/base.html' %}
{% load static %}

{% block title %}‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ | IMSUK{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 py-8">
    <h1 class="text-2xl font-bold mb-6 text-pink-700">üßæ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h1>

    <form method="POST" action="{% url 'place_order' %}">
        {% csrf_token %}

        <!-- üöö ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á -->
        <div class="mb-6">
        <h2 class="text-xl font-semibold mb-2">üìç ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</h2>
        {% if addresses %}
            {% for address in addresses %}
            <label class="flex items-start mb-2">
                <input type="radio" name="address" value="{{ address.id }}" class="mr-2 mt-1" {% if address.id == default_address.id %}checked{% endif %}>
                <div>
                <strong>{{ address.label }}</strong> <span class="text-sm text-gray-500">({{ address.get_icon_display }})</span><br>
                {{ address.street }}, {{ address.subdistrict }}, {{ address.district }}, {{ address.province }} {{ address.postal_code }}
                </div>
            </label>
            {% endfor %}
        {% else %}
            <p class="text-red-500">‚ö†Ô∏è ‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ "‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô"</p>
        {% endif %}
        </div>

        <!-- üç± ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£ -->
        <div class="mb-6">
        <h2 class="text-xl font-semibold mb-2">üçΩ ‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h2>
        <ul class="divide-y border rounded">
            {% for item in cart_items %}
            <li class="p-3 flex justify-between items-center">
                <span>{{ item.menu_item.name }} x {{ item.quantity }}</span>
                <span>{{ item.menu_item.price|floatformat:2 }} ‡∏ö‡∏≤‡∏ó</span>
            </li>
            {% endfor %}
        </ul>
        </div>

        <!-- üí≥ ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô -->
        <div class="mb-6">
        <h2 class="text-xl font-semibold mb-2">üí∞ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h2>
        {{ payment_form.payment_method }}

        <div id="card-info" class="mt-4 hidden">
            <label class="block mb-2">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£:</label>
            {{ payment_form.card_number }}
            <label class="block mt-2 mb-2">‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ (MM/YY):</label>
            {{ payment_form.expiry_date }}
            <label class="block mt-2 mb-2">CVV:</label>
            {{ payment_form.cvv }}
        </div>
        </div>

        <!-- ‚úÖ ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô -->
        <div class="text-right">
        <button type="submit" class="bg-pink-600 text-white px-6 py-2 rounded hover:bg-pink-700 transition">
            üõí ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
        </button>
        </div>
    </form>
    </div>

    <script>
    // ‡πÅ‡∏™‡∏î‡∏á/‡∏ã‡πà‡∏≠‡∏ô‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏±‡∏ï‡∏£
    const paymentRadios = document.querySelectorAll('input[name="payment_method"]');
    const cardInfoSection = document.getElementById('card-info');

    paymentRadios.forEach(radio => {
        radio.addEventListener('change', () => {
        if (radio.value === 'card') {
            cardInfoSection.classList.remove('hidden');
        } else {
            cardInfoSection.classList.add('hidden');
        }
        });
    });

    // ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å ‚Üí ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    window.addEventListener('DOMContentLoaded', () => {
        const selected = document.querySelector('input[name="payment_method"]:checked');
        if (selected && selected.value === 'card') {
        cardInfoSection.classList.remove('hidden');
        }
    });
</script>
{% endblock %}
